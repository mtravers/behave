(in-package :beh)#| ######################################################################interface to alanr's sheet packageCopyright © 1996-7 Michael TraversPart of the Behave! systemSend questions, comments, and fixes to mt@media.mit.edu.###################################################################### |#;* (load "alanr;sheet:sheet-file-set.lisp")(load "beh:alanr;sheet;sheet-file-set.lisp")(ccl::load-if-newer "sheet");* (require :sheet-patches)(load "beh:mt;sheet-patches.lisp");;; redefine the Sheet set-view-level to be faster (I think this is correct, but not sure)(defmethod set-view-level ((view ccl::a-base) level)  (without-interrupts   (let ((container (view-container view)))     (when container       (let* ((siblings (view-subviews container))              (cnt (length siblings))              (new-pos (- cnt 1 level))              (old-pos (position view siblings :test #'eq))              (i old-pos))         (when (or (< new-pos 0) (>= new-pos cnt))           (error "Level out of range."))         (cond ((eql new-pos old-pos)                (return-from set-view-level level))               ((< new-pos old-pos)                (ccl::while (< new-pos i)                  (setf (aref siblings i) (aref siblings (1- i)))                  (decf i)))               (t                        ; (> new-pos old-pos)                (ccl::while (> new-pos i)                  (setf (aref siblings i) (aref siblings (1+ i)))                  (incf i))))         (setf (aref siblings new-pos) view);         (invalidate-view container)    ; a bit slow, but invalidating only the region of the moved frame doesn't work for some reason.         (invalidate-view view)         ; well this seems to work today, and is much faster.         ))))  level)