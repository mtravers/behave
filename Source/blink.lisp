(in-package :beh)#| ######################################################################Support blinking for drop-targets. Ideally this file is modular  and can be removed if necessary.Copyright © 1996-7 Michael Travers Part of the Behave! systemSend questions, comments, and fixes to mt@media.mit.edu.###################################################################### |#(defclass* blinking-mixin (view)  ((blinked? :initform nil :accessor blinked?)))(defmethod* view-draw-contents :around ((v blinking-mixin))  (if blinked?    (view-draw-blinked-contents v)    (call-next-method)))(defmethod view-draw-blinked-contents ((v blinking-mixin))  (with-rect (r 0 (view-size v))    (with-rgb (c *yellow-color*)      (#_rgbForeColor c)      (#_PaintRect r ))))(defun blink-test (v sleep)  (do () (())    (setf (slot-value v 'blinked?)          (not (slot-value v 'blinked?)))    (invalidate-view v)    (window-update-event-handler (view-window v))    (sleep sleep)))(defvar *blinking-view* nil)            ; just one for now(defparameter *blink-rate* .1)(defmethod blink ((v blinking-mixin))  (awhen *blinking-view*    (unblink it))  (setf *blinking-view* v))(defmethod unblink ((v blinking-mixin))  (ccl::without-interrupts    (setf (blinked? v) nil)   (when (eq *blinking-view* v)     (setf *blinking-view* nil)))  (invalidate-view v))   (defun background-blinker ()  (do (v) (())    (process-wait "No blink" #'(lambda () *blinking-view*))    (setf v *blinking-view*)    (setf (slot-value v 'blinked?)          (not (slot-value v 'blinked?)))    (invalidate-view v)    (window-update-event-handler (view-window v))    (sleep *blink-rate*)))(u::now-and-on-startup (blink-process)  (process-run-function '(:name "Blinker" :priority 1) #'background-blinker));;; Interface to existing classes(defclass* highlight-mixin (blinking-mixin)   ((highlighted? :initform nil)))(defmethod view-draw-contents :after ((view highlight-mixin))  )(defmethod highlight-view ((view highlight-mixin))  (blink view))(defmethod unhighlight-view ((view highlight-mixin))  (unblink view))