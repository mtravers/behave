;; ****************************************************************;;;; Author: Alan Ruttenberg, MIT Media Lab;; email:  alanr@media.mit.edu;;;; Support shared libraries in file sets. Shared libraries have the suffix .slib. Currently they need to be;; copied to the ccl folder. The specification [ :shared-libraries ";regex" ] means copy regex.slib to ;; ccl::regex.slib if there is no copy there, or if the file-set version is a later date than the ;; already installed shared library.;;;; Created: Thursday November 21,1996;; ;; ****************************************************************(in-package :ccl)(defun ensure-shared-libraries-installed (file-set &key (shared-libraries (file-set-shared-libraries file-set)))  (let ((paths shared-libraries))    (when (null paths) (return-from ensure-shared-libraries-installed))    (when (not (consp paths)) (setq paths (list paths)))    (setq paths (loop for path in paths                       append                      (resolve-pathname-spec file-set path )))    (loop for path in paths          do          (setq path (merge-pathnames ".slib" path))          (let ((library-path (merge-pathnames (pathname-name path)                                                (make-pathname :host "ccl" :type "slib"))))            (multiple-value-bind (exists? error?) (ignore-errors (probe-file library-path))              (when (and (not error?)                          (or (not exists?)                             (< (mac-file-write-date library-path) (mac-file-write-date path))))                (when                  (y-or-n-dialog (format nil "I need to install a current version of the shared library ~s. Is that ok?"                                          (pathname-name library-path))                                 :size #@(300 200)                                 :yes-text "OK")                  (format t "~&;;; Copying ~s to ~s"                          path library-path)                  (delete-file library-path)                  (copy-file path library-path :if-exists :supersede)                  (ccl::reload-shared-library (pathname-name path))                  )))))))